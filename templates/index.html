<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allocation Application</title>
    <style>
        /* Black Theme CSS */
        body {
            font-family: Arial, sans-serif;
            background-color: #1a1a1a; /* Dark grey body background */
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #ffffff; /* Default text color for body */
        }
        .container {
            background-color: #000000; /* Black container */
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5); /* Darker shadow for contrast */
            width: 100%;
            max-width: 600px;
            box-sizing: border-box;
            margin-bottom: 20px;
            text-align: center;
        }
        .logo {
            width: 250px;
            height: auto;
            margin-bottom: 20px;
        }
        h1 {
            color: #e0e0e0; /* Light grey for main title */
            text-align: center;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 15px;
            text-align: left;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #ffffff; /* White for labels */
        }
        input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #555555; /* Medium grey border */
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1em;
            padding-top: 3px;
            padding-bottom: 3px;
            background-color: #333333; /* Dark grey input background */
            color: #ffffff; /* White text for input */
        }
        button {
            background-color: #007bff; /* Vibrant blue for buttons */
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.1em;
            width: 100%;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #0056b3; /* Darker blue on hover */
        }
        .flash-messages {
            list-style-type: none;
            padding: 0;
            margin-bottom: 20px;
            width: 100%;
            max-width: 600px;
        }
        .flash-messages li {
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            font-weight: bold;
            text-align: left;
            color: #ffffff; /* Default white text for flash messages */
        }
        /* Flash message specific colors for dark theme */
        .flash-messages li.error {
            background-color: #721c24; /* Dark red background */
            border: 1px solid #f5c6cb;
            color: #f8d7da; /* Light red text */
        }
        .flash-messages li.success {
            background-color: #155724; /* Dark green background */
            border: 1px solid #c3e6cb;
            color: #d4edda; /* Light green text */
        }
        .flash-messages li.info {
            background-color: #0c5460; /* Dark cyan background */
            border: 1px solid #bee5eb;
            color: #d1ecf1; /* Light cyan text */
        }
        .flash-messages li.warning {
            background-color: #856404; /* Dark yellow background */
            border: 1px solid #ffeeba;
            color: #fff3cd; /* Light yellow text */
        }
        .download-links {
            margin-top: 20px;
            text-align: center;
        }
        .download-links h2 {
            color: #e0e0e0; /* Light grey for download title */
            margin-bottom: 10px;
        }
        .download-links p {
            color: #ffffff; /* White for download description */
            margin-bottom: 15px;
        }
        .download-links a {
            display: inline-block;
            background-color: #007bff; /* Vibrant blue for download link */
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            text-decoration: none;
            margin: 5px;
            transition: background-color 0.3s ease;
        }
        .download-links a:hover {
            background-color: #0056b3; /* Darker blue on hover */
        }
 
        /* Styles for the Modal (Rules Popup) */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Higher z-index to ensure it's on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.8); /* Darker overlay */
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #222222; /* Dark grey for modal content */
            margin: auto;
            padding: 25px; /* Slightly more padding */
            border: 1px solid #444444; /* Darker border */
            border-radius: 8px;
            width: 85%; /* Slightly wider */
            max-width: 800px; /* Larger max width */
            box-shadow: 0 5px 15px rgba(0,0,0,0.7); /* More pronounced shadow */
            animation-name: animatetop;
            animation-duration: 0.4s;
            color: #ffffff; /* White text for modal content */
        }
        /* Add Animation */
        @keyframes animatetop {
            from {top: -300px; opacity: 0}
            to {top: 0; opacity: 1}
        }
        .close-button {
            color: #ffffff; /* White close button */
            float: right;
            font-size: 30px; /* Slightly larger */
            font-weight: bold;
            margin-top: -10px; /* Adjust positioning */
            margin-right: -5px; /* Adjust positioning */
        }
        .close-button:hover,
        .close-button:focus {
            color: #cccccc; /* Lighter grey on hover */
            text-decoration: none;
            cursor: pointer;
        }
        .modal-content h2 {
            color: #007bff; /* Vibrant blue for modal title */
            margin-top: 0;
            text-align: left;
            margin-bottom: 20px;
        }
        .modal-content ul {
            list-style-type: decimal;
            text-align: left;
            margin-left: 25px;
            padding-left: 0;
            color: #ffffff; /* White for list items */
        }
        .modal-content ul li {
            margin-bottom: 12px;
            line-height: 1.4;
            font-size: 1em;
        }
        .modal-content ul li strong {
            color: #007bff; /* Vibrant blue for bold text within rules */
            font-weight: bold;
        }
        /* For sub-lists within rules */
        .modal-content ul ul {
            list-style-type: disc;
            margin-top: 8px;
            margin-bottom: 8px;
            margin-left: 20px;
        }
        .modal-content ul ul li {
            margin-bottom: 5px;
            color: #cccccc; /* Lighter grey for sub-list items */
            font-size: 0.9em;
        }
        .rules-link {
            display: block;
            text-align: right;
            margin-top: -20px;
            margin-bottom: 15px;
        }
        .rules-link a {
            color: #007bff; /* Vibrant blue for rules link */
            text-decoration: none;
            font-weight: bold;
        }
        .rules-link a:hover {
            text-decoration: underline;
            color: #0099ff; /* Lighter blue on hover */
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Bosch Image.png added here -->
        <!-- Make sure the filename is correct based on what you have in static/images/ -->
        <img src="{{ url_for('static', filename='images/Bosch.png') }}" alt="Bosch Logo" class="logo">
        <h1>B-SEGMENT ALLOCATION</h1>
 
        <div class="rules-link">
            <a href="#" id="openRulesModal">View Rules & Instructions</a>
        </div>
       
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <ul class="flash-messages">
                    {% for category, message in messages %}
                        <li class="{{ category }}">{{ message }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}
 
        <form action="/process" method="post" enctype="multipart/form-data">
            <div class="form-group">
                <label for="pisa_file">Upload PISA Excel File (.xlsx):</label>
                <input type="file" name="pisa_file" id="pisa_file" accept=".xlsx" required>
            </div>
            <div class="form-group">
                <label for="esm_file">Upload ESM Excel File (.xlsx):</label>
                <input type="file" name="esm_file" id="esm_file" accept=".xlsx" required>
            </div>
            <div class="form-group">
                <label for="pm7_file">Upload PM7 Excel File (.xlsx):</label>
                <input type="file" name="pm7_file" id="pm7_file" accept=".xlsx" required>
            </div>
            <div class="form-group">
                <label for="workon_file">Upload Workon P71 Excel File (.xlsx):</label>
                <input type="file" name="workon_file" id="workon_file" accept=".xlsx" required>
            </div>
            <div class="form-group">
                <label for="workon_rgba_file">Upload Workon RGBA Excel File (.xlsx):</label>
                <input type="file" name="workon_rgba_file" id="workon_rgba_file" accept=".xlsx" required>
            </div>
            <div class="form-group">
                <label for="central_file">Upload Central Excel File (.xlsx):</label>
                <input type="file" name="central_file" id="central_file" accept=".xlsx" required>
            </div>
            <button type="submit">Process Files</button>
        </form>
       
        {% if central_download_link %}
            <div class="download-links">
                <h2>Processing Complete!</h2>
                <p>Your processed file is ready:</p>
                <a href="{{ central_download_link }}" download>Download Updated Central File</a>
            </div>
        {% endif %}
    </div>
 
    <!-- The Modal (Rules Popup) -->
    <div id="rulesModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Allocation Application Rules & Guidelines</h2>
            <ul>
                <li>All uploaded files <strong>must be in .xlsx format</strong>.</li>
                <li><strong>Tracker File Download:</strong> Download the tracker file when nobody is actively using it. Navigate to:
                    <strong>Teams channel</strong> &rarr; <strong>General</strong> &rarr; <strong>Files</strong> &rarr; <strong>PBI_Database</strong> &rarr; <strong>B-Segment</strong> &rarr; <code>New B_Segment(yesterday's date).xlsx</code></li>
                <li><strong>Tracker File Columns:</strong> Ensure the tracker file (Central File) contains the following columns with <strong>exact naming</strong> (case-sensitive and including spaces):<br>
                    <code>Barcode</code>, <code>Processor</code>, <code>Channel</code>, <code>Category</code>, <code>Company code</code>, <code>Region</code>, <code>Vendor number</code>, <code>Vendor Name</code>, <code>Status</code>, <code>Received Date</code>, <code>Re-Open Date</code>, <code>Allocation Date</code>, <code>Clarification Date</code>, <code>Completion Date</code>, <code>Requester</code>, <code>Remarks</code>, <code>Aging</code>, <code>Today</code>.<br>
                    <strong>No filters should be applied</strong> in the downloaded tracker file.</li>
                <li><strong>ESM Mandatory Columns:</strong> After internal processing, the ESM file should contain the following columns:
                    <ul>
                        <li><strong>Company code</strong> (with a space after company)</li>
                        <li><strong>Subcategory</strong> (with no spacing between the words)</li>
                        <li><strong>Received date</strong> (with a space after received, mapped from 'Updated')</li>
                    </ul>
                </li>
                <li><strong>PISA Mandatory Columns:</strong> After internal processing, the PISA file should contain the following columns:
                    <ul>
                        <li><strong>Vendor name</strong> (with a space after vendor)</li>
                        <li><strong>Vendor number</strong> (with a space after vendor)</li>
                        <li><strong>Company code</strong> (with a space after company)</li>
                        <li><strong>Received date</strong> (with a space after received, mapped from 'Creation date')</li>
                    </ul>
                </li>
                <li><strong>PM7 Mandatory Columns:</strong> After internal processing, the PM7 file should contain the following columns:
                    <ul>
                        <li><strong>Vendor name</strong> (with a space after vendor)</li>
                        <li><strong>Vendor number</strong> (with a space after vendor)</li>
                        <li><strong>Company code</strong> (with a space after company)</li>
                        <li><strong>Received date</strong> (with a space after received, mapped from 'Creation date')</li>
                    </ul>
                </li>
                <li><strong>Workon P71 Mandatory Columns & Mapping:</strong> The Workon P71 file will be appended to the finalized Central File. The following columns are mapped (case-insensitive, first word matching, ignoring spaces):
                    <ul>
                        <li>Central <code>Barcode</code> &larr; Workon P71 <code>key</code></li>
                        <li>Central <code>Processor</code> &larr; "Jayapal" (Hardcoded)</li>
                        <li>Central <code>Channel</code> &larr; "Workon" (Hardcoded)</li>
                        <li>Central <code>Category</code> &larr; Workon P71 <code>action</code></li>
                        <li>Central <code>Company code</code> &larr; Workon P71 <code>company code</code></li>
                        <li>Central <code>Region</code> &larr; Workon P71 <code>country</code></li>
                        <li>Central <code>Vendor number</code> &larr; Workon P71 <code>vendor number</code></li>
                        <li>Central <code>Vendor Name</code> &larr; Workon P71 <code>name</code></li>
                        <li>Central <code>Status</code> &larr; Workon P71 <code>status</code></li>
                        <li>Central <code>Received Date</code> &larr; Workon P71 <code>updated</code></li>
                        <li>Central <code>Re-Open Date</code> &larr; (Blank)</li>
                        <li>Central <code>Allocation Date</code> &larr; (Today's Date)</li>
                        <li>Central <code>Clarification Date</code> &larr; (Blank)</li>
                        <li>Central <code>Completion Date</code> &larr; (Blank)</li>
                        <li>Central <code>Requester</code> &larr; Workon P71 <code>applicant</code></li>
                        <li>Central <code>Remarks</code> &larr; Workon P71 <code>summary</code></li>
                        <li>Central <code>Aging</code> &larr; (Blank)</li>
                        <li>Central <code>Today</code> &larr; (Today's Date)</li>
                    </ul>
                </li>
                <li><strong>Workon RGBA Mandatory Columns, Filter & Mapping:</strong> The Workon RGBA file will be filtered and appended to the finalized Central File.
                    <p><strong>Filter Condition:</strong> Only records where <code>Current Assignee</code> is "VMD GS OSP-NA (GS/OMD-APAC)" will be processed.</p>
                    <p>The following columns are mapped (case-insensitive, first word matching, ignoring spaces):</p>
                    <ul>
                        <li>Central <code>Barcode</code> &larr; Workon RGBA <code>key</code></li>
                        <li>Central <code>Processor</code> &larr; "Divya" (Hardcoded)</li>
                        <li>Central <code>Channel</code> &larr; "Workon" (Hardcoded)</li>
                        <li>Central <code>Category</code> &larr; (<strong>Clarification Needed:</strong> What Workon RGBA column maps to Category, or should it be blank?)</li>
                        <li>Central <code>Company code</code> &larr; Workon RGBA <code>company code</code></li>
                        <li>Central <code>Region</code> &larr; (Automatically mapped from <code>company_code_region_mapping.xlsx</code> based on <code>Company code</code>)</li>
                        <li>Central <code>Vendor number</code> &larr; (<strong>Clarification Needed:</strong> What Workon RGBA column maps to Vendor number, or should it be blank?)</li>
                        <li>Central <code>Vendor Name</code> &larr; (<strong>Clarification Needed:</strong> What Workon RGBA column maps to Vendor Name, or should it be blank?)</li>
                        <li>Central <code>Status</code> &larr; (<strong>Clarification Needed:</strong> What Workon RGBA column maps to Status, or should it be blank?)</li>
                        <li>Central <code>Received Date</code> &larr; Workon RGBA <code>Updated</code></li>
                        <li>Central <code>Re-Open Date</code> &larr; (Blank)</li>
                        <li>Central <code>Allocation Date</code> &larr; (Today's Date)</li>
                        <li>Central <code>Clarification Date</code> &larr; (Blank)</li>
                        <li>Central <code>Completion Date</code> &larr; (Blank)</li>
                        <li>Central <code>Requester</code> &larr; (<strong>Clarification Needed:</strong> What Workon RGBA column maps to Requester, or should it be blank?)</li>
                        <li>Central <code>Remarks</code> &larr; Workon RGBA <code>summary</code></li>
                        <li>Central <code>Aging</code> &larr; (Blank)</li>
                        <li>Central <code>Today</code> &larr; (Today's Date)</li>
                    </ul>
                </li>
                <li><strong>Processing & Upload:</strong> Upload the ESM, PISA, PM7, Workon P71, Workon RGBA, and Central files. Then, click on the <strong>"Process Files"</strong> button. The new updated tracker file will be automatically downloaded and will be ready for allocation.</li>
                <li><strong>Post-Processing Actions:</strong>
                    <ul>
                        <li><strong>Rename & Upload:</strong> Replace the newly downloaded file by renaming it to <code>New B_Segment(DD_MM_YYYY)</code> with <strong>today's date</strong> in the Teams channel.</li>
                        <li><strong>Archive Old File:</strong> Move the <code>New B_Segment(DD_MM_YYYY)</code> with <strong>yesterday's date</strong> into the <strong><code>Old Data (Do not Modify)</code> folder</strong>.</li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
 
    <script>
        // Get the modal
        var modal = document.getElementById("rulesModal");
 
        // Get the button that opens the modal
        var btn = document.getElementById("openRulesModal");
 
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close-button")[0];
 
        // When the user clicks the button, open the modal
        btn.onclick = function() {
            modal.style.display = "flex"; // Use flex to center
        }
 
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
            modal.style.display = "none";
        }
 
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    </script>
</body>
</html>
